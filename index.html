<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>HobbyNB - Find Activity Partners</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <style>
        body { margin: 0; padding: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; overflow: hidden; }

        /* --- 1. Rolling Ticker --- */
        .ticker-wrap {
            position: fixed; top: 0; width: 100%; height: 40px; background-color: #ff4757; color: white;
            z-index: 2000; overflow: hidden; display: flex; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .ticker {
            display: inline-block; white-space: nowrap; padding-left: 100%;
            animation: ticker 25s linear infinite; font-weight: 600; font-size: 14px;
        }
        @keyframes ticker {
            0% { transform: translate3d(0, 0, 0); }
            100% { transform: translate3d(-100%, 0, 0); }
        }

        /* --- 2. Map Layer --- */
        #map { width: 100vw; height: 100vh; z-index: 1; margin-top: 40px; /* Offset for ticker */ }

        /* --- 3. Static Center Pin (CSS Only) --- */
        .center-pin {
            position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            z-index: 500; pointer-events: none;
            margin-top: 20px; /* Adjust slightly for the ticker offset */
        }
        .pin-circle {
            width: 20px; height: 20px;
            background: #1e90ff; border: 3px solid white;
            border-radius: 50%;
            box-shadow: 0 0 0 10px rgba(30, 144, 255, 0.3);
        }

        /* --- 4. NEW: Current Location Button --- */
        .locate-btn {
            position: absolute; 
            top: 60px; /* Below the ticker */
            right: 20px;
            z-index: 1000; /* Above map, below ticker */
            background: white;
            border: none;
            width: 44px; height: 44px;
            border-radius: 50%;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            transition: transform 0.2s;
        }
        .locate-btn:active { transform: scale(0.95); }
        .locate-btn svg { width: 24px; height: 24px; fill: #333; }
        .locate-btn:hover svg { fill: #1e90ff; }

        /* --- 5. Animated Markers & Bubbles --- */
        .marker-wrap {
            position: relative; text-align: center;
            animation: bounce 2s infinite ease-in-out;
        }
        .emoji-icon { font-size: 35px; filter: drop-shadow(0 2px 2px rgba(0,0,0,0.3)); }
        
        .emoji-bubble {
            background: white; padding: 4px 8px; border-radius: 12px;
            font-size: 11px; font-weight: bold; color: #333;
            border: 1px solid #ccc;
            position: absolute; top: -25px; left: 50%; transform: translateX(-50%);
            white-space: nowrap; box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .emoji-bubble::after {
            content: ''; position: absolute; bottom: -5px; left: 50%; margin-left: -5px;
            border-width: 5px; border-style: solid; 
            border-color: white transparent transparent transparent;
        }
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-8px); }
        }

        /* --- 6. UI Control Panel --- */
        .ui-container {
            position: absolute; bottom: 20px; left: 0; right: 0;
            z-index: 999; display: flex; justify-content: center;
            pointer-events: none; 
        }
        .control-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(5px);
            border-radius: 20px; padding: 20px;
            width: 90%; max-width: 400px;
            text-align: center;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            pointer-events: auto;
        }
        
        h2 { margin: 0 0 5px 0; font-size: 1.2rem; color: #333; }
        p { margin: 0 0 15px 0; font-size: 0.8rem; color: #666; }

        .hobby-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 15px; }
        .hobby-btn {
            background: #f1f2f6; border: 1px solid #ddd;
            border-radius: 8px; padding: 10px; font-size: 0.85rem;
            cursor: pointer; transition: 0.2s;
        }
        .hobby-btn.active { background: #2ed573; color: white; border-color: #2ed573; }

        .whatsapp-btn {
            background: #25D366; color: white; border: none;
            padding: 12px 30px; border-radius: 50px;
            font-weight: bold; font-size: 1rem; cursor: pointer;
            width: 100%; display: flex; align-items: center; justify-content: center;
        }
        .whatsapp-btn:hover { background: #20bd5a; }

    </style>
</head>
<body>

    <div class="ticker-wrap">
        <div class="ticker">
            Find activity partners near you Â â€¢Â Â  â‚¹1 lifetime membership, 100% refund guarantee Â Â â€¢Â Â  Tennis, Badminton, Art, Dance & more! Â Â â€¢Â Â  Join curated groups...
        </div>
    </div>

    <button class="locate-btn" onclick="goToCurrentLocation()" title="Go to current location">
        <svg viewBox="0 0 24 24">
            <path d="M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm8.94 3c-.46-4.17-3.77-7.48-7.94-7.94V1h-2v2.06C6.83 3.52 3.52 6.83 3.06 11H1v2h2.06c.46 4.17 3.77 7.48 7.94 7.94V23h2v-2.06c4.17-.46 7.48-3.77 7.94-7.94H23v-2h-2.06zM12 19c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"/>
        </svg>
    </button>

    <div class="center-pin"><div class="pin-circle"></div></div>

    <div id="map"></div>

    <div class="ui-container">
        <div class="control-panel">
            <h2>Find Hobby Partners</h2>
            <p>1. Drag map to your location<br>2. Select hobbies & Join via WhatsApp</p>

            <div class="hobby-grid" id="hobbyGrid"></div>
            
            <button class="whatsapp-btn" onclick="sendToWhatsapp()">
                Join Now (WhatsApp)
            </button>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script>

        const hobbies = [
            { label: 'Dance', emoji: 'ðŸ’ƒ', text: "Let's dance!" },
            { label: 'Paint', emoji: 'ðŸŽ¨', text: "Let's paint!" },
            { label: 'Tennis', emoji: 'ðŸŽ¾', text: "Tennis match?" },
            { label: 'Badminton', emoji: 'ðŸ¸', text: "Play badminton?" },
            { label: 'Music', emoji: 'ðŸŽ¸', text: "Jam session?" },
            { label: 'Chess', emoji: 'â™Ÿï¸', text: "Chess game?" }
        ];

        let selectedHobbies = [];

        // Map Setup
        const map = L.map('map', { zoomControl: false }).setView([13.0827, 80.2707], 13);
        L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
            attribution: 'Â© OpenStreetMap', maxZoom: 19
        }).addTo(map);

        // --- NEW: Go To Location Function ---
        function goToCurrentLocation() {
            if (!navigator.geolocation) {
                alert("Geolocation is not supported by your browser.");
                return;
            }

            // Visual feedback (rotate icon or dim it) could go here
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    const lat = position.coords.latitude;
                    const lng = position.coords.longitude;
                    map.setView([lat, lng], 16); // Zoom in closer on success
                },
                () => {
                    alert("Unable to retrieve your location. Please ensure GPS is enabled.");
                }
            );
        }

        // --- DECORATIVE MARKERS WITH BUBBLES ---
        const markersLayer = L.layerGroup().addTo(map);

        function addRandomFloaters() {
            markersLayer.clearLayers();
            const bounds = map.getBounds();
            
            // Add 3 random markers
            for(let i=0; i<3; i++) {
                const lat = bounds.getSouth() + Math.random() * (bounds.getNorth() - bounds.getSouth());
                const lng = bounds.getWest() + Math.random() * (bounds.getEast() - bounds.getWest());
                const h = hobbies[Math.floor(Math.random() * hobbies.length)];
                
                const htmlContent = `
                    <div class="marker-wrap">
                        <div class="emoji-bubble">${h.text}</div>
                        <div class="emoji-icon">${h.emoji}</div>
                    </div>`;

                const icon = L.divIcon({
                    className: '', 
                    html: htmlContent,
                    iconSize: [40, 60],
                    iconAnchor: [20, 40] 
                });

                L.marker([lat, lng], {icon: icon}).addTo(markersLayer);
            }
        }
        
        map.on('moveend', addRandomFloaters);
        addRandomFloaters();

        // --- UI & WHATSAPP LOGIC ---
        const grid = document.getElementById('hobbyGrid');
        hobbies.forEach(h => {
            const btn = document.createElement('div');
            btn.className = 'hobby-btn';
            btn.innerText = `${h.emoji} ${h.label}`;
            btn.onclick = () => {
                btn.classList.toggle('active');
                if (selectedHobbies.includes(h.label)) {
                    selectedHobbies = selectedHobbies.filter(i => i !== h.label);
                } else {
                    selectedHobbies.push(h.label);
                }
            };
            grid.appendChild(btn);
        });

        function sendToWhatsapp() {
            if (selectedHobbies.length === 0) {
                alert("Please select at least one hobby!");
                return;
            }
            const center = map.getCenter();
            const lat = center.lat.toFixed(6);
            const lng = center.lng.toFixed(6);
            
            // Create Google Maps Link
            const mapLink = `https://www.google.com/maps?q=${lat},${lng}`;

            const text = 
`Hi! I want to find hobby partners.

*Hobbies:* ${selectedHobbies.join(', ')}
*My Location:* ${mapLink}`;

            window.open(`https://wa.me/31682349653?text=${encodeURIComponent(text)}`, '_blank');
        }
    </script>
</body>
</html>
